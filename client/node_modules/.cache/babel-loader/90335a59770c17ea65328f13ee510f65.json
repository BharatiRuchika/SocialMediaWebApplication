{"ast":null,"code":"import _asyncToGenerator from\"/Users/ruchikaashokbharati/Documents/SocialMediaProject-main/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _toConsumableArray from\"/Users/ruchikaashokbharati/Documents/SocialMediaProject-main/client/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"/Users/ruchikaashokbharati/Documents/SocialMediaProject-main/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/ruchikaashokbharati/Documents/SocialMediaProject-main/client/node_modules/@babel/runtime/regenerator/index.js\";import React,{useEffect,useState,useRef}from'react';import UserCard from\"../UserCard\";import{useDispatch,useSelector}from'react-redux';import{useParams}from'react-router-dom';import MsgDisplay from'./MsgDisplay';import Icons from\"../Icons\";import{GLOBALTYPES}from'../../redux/actions/globalTypes';import{imageShow,videoShow}from'../../utils/mediaShow';import{imageUpload}from'../../utils/imageUpload';import{addMessage,getMessages,MESSAGE_TYPES}from'../../redux/actions/messageAction';import LoadIcon from'../../images/loading.gif';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var RightSide=function RightSide(){var _useSelector=useSelector(function(state){return state;}),auth=_useSelector.auth,message=_useSelector.message,theme=_useSelector.theme,socket=_useSelector.socket;var dispatch=useDispatch();var _useState=useState([]),_useState2=_slicedToArray(_useState,2),user=_useState2[0],setUser=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),text=_useState4[0],setText=_useState4[1];var _useState5=useState(0),_useState6=_slicedToArray(_useState5,2),page=_useState6[0],setPage=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),data=_useState8[0],setData=_useState8[1];var _useParams=useParams(),id=_useParams.id;var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),media=_useState10[0],setMedia=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),loadMedia=_useState12[0],setLoadMedia=_useState12[1];var refDisplay=useRef();var pageEnd=useRef();useEffect(function(){console.log(\"socket\",socket);console.log(\"auth\",auth.user);var newData=message.data.filter(function(item){return item.sender===auth.user._id||item.sender===id;});console.log(\"newdata\",newData);setData(newData);},[message.data,auth.user._id,id]);useEffect(function(){var newUser=message.users.find(function(user){return user._id===id;});console.log(\"newUser\",newUser);if(newUser){setUser(newUser);}},[message.users,id]);var handleChangeMedia=function handleChangeMedia(e){var files=_toConsumableArray(e.target.files);var err=\"\";var newMedia=[];files.forEach(function(file){if(!file){return err=\"File does not exist.\";}if(file.size>1024*1024*5){return err=\"Image size must be less than 5 mb.\";}return newMedia.push(file);});if(err){dispatch({type:GLOBALTYPES.ALERT,payload:{error:err}});}setMedia([].concat(_toConsumableArray(media),newMedia));};var handleDeleteMedia=function handleDeleteMedia(index){console.log(\"im in handle delete media\");var newArr=_toConsumableArray(media);newArr.splice(index,1);setMedia(newArr);};var handleSubmit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var newArr,msg;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();console.log(\"text\",text);if(!(!text.trim()&&media.length===0)){_context.next=4;break;}return _context.abrupt(\"return\");case 4:setText('');setMedia([]);setLoadMedia(true);newArr=[];if(!(media.length>0)){_context.next=12;break;}_context.next=11;return imageUpload(media);case 11:newArr=_context.sent;case 12:msg={sender:auth.user._id,recipient:id,text:text,media:newArr,createdAt:new Date().toISOString()};setLoadMedia(false);_context.next=16;return dispatch(addMessage({msg:msg,auth:auth,socket:socket}));case 16:if(refDisplay.current){refDisplay.current.scrollIntoView({behaviour:\"smooth\",block:\"end\"});}case 17:case\"end\":return _context.stop();}}},_callee);}));return function handleSubmit(_x){return _ref.apply(this,arguments);};}();useEffect(function(){if(id){var getMessagesData=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:dispatch({type:MESSAGE_TYPES.GET_MESSAGES,payload:{messages:[]}});setPage(1);dispatch(getMessages({auth:auth,id:id}));if(refDisplay.current){refDisplay.current.scrollIntoView({behaviour:'smooth',block:'end'});}case 4:case\"end\":return _context2.stop();}}},_callee2);}));return function getMessagesData(){return _ref2.apply(this,arguments);};}();getMessagesData();}},[id,dispatch,auth]);// load more\nuseEffect(function(){var observer=new IntersectionObserver(function(entries){if(entries[0].isIntersecting){setPage(function(p){return p+1;});}},{threshold:0.1});observer.observe(pageEnd.current);},[setPage]);useEffect(function(){if(message.resultData>=(page-1)*9&&page>1){dispatch(getMessages({auth:auth,id:id,page:page}));}},[message.resultData,page,id,auth,dispatch]);useEffect(function(){if(refDisplay.current){refDisplay.current.scrollIntoView({behaviour:\"smooth\",block:\"end\"});}},[text]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"message_header\",children:user.length!==0&&/*#__PURE__*/_jsx(UserCard,{user:user,children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-trash text-danger\"})})}),/*#__PURE__*/_jsx(\"div\",{className:\"chat_container\",style:{height:media.length>0?\"calc(100% - 180px)\":\"\"},children:/*#__PURE__*/_jsxs(\"div\",{className:\"chat_display\",ref:refDisplay,children:[/*#__PURE__*/_jsx(\"button\",{style:{marginTop:'-25px',opacity:0},ref:pageEnd,children:\"Load..\"}),data.map(function(msg,index){return/*#__PURE__*/_jsxs(\"div\",{children:[msg.sender!==auth.user._id&&/*#__PURE__*/_jsx(\"div\",{className:\"chat_row other_message\",children:/*#__PURE__*/_jsx(MsgDisplay,{user:user,msg:msg,theme:theme})}),msg.sender===auth.user._id&&/*#__PURE__*/_jsx(\"div\",{className:\"chat_row you_message\",children:/*#__PURE__*/_jsx(MsgDisplay,{user:auth.user,msg:msg,theme:theme})})]},index);}),loadMedia&&/*#__PURE__*/_jsx(\"div\",{className:\"chat_row you_message\",children:/*#__PURE__*/_jsx(\"img\",{src:LoadIcon,alt:\"Loading...\"})})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"show_media\",style:{display:media.length>0?\"\":\"none\"},children:media.map(function(item,index){return/*#__PURE__*/_jsxs(\"div\",{id:\"file_media\",children:[item.type.match(/video/i)?videoShow(URL.createObjectURL(item),theme):imageShow(URL.createObjectURL(item),theme),/*#__PURE__*/_jsx(\"span\",{onClick:function onClick(){return handleDeleteMedia(index);},children:\"\\xD7\"})]},index);})}),/*#__PURE__*/_jsxs(\"form\",{className:\"chat_input\",onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(\"input\",{placeholder:\"Type a message.\",type:\"text\",value:text,onChange:function onChange(e){return setText(e.target.value);},style:{filter:theme?\"invert(1)\":\"invert(0)\",background:theme?'#040404':'',color:theme?'white':''}}),/*#__PURE__*/_jsx(Icons,{setContent:setText,content:text,theme:theme}),/*#__PURE__*/_jsxs(\"div\",{className:\"file_upload\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-image color-c1\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",name:\"file\",id:\"file\",multiple:true,accept:\"image/*,video/*\",onChange:handleChangeMedia})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:text||media.length>0?false:true,className:\"material-icons\",children:\"near_me\"})]})]});};export default RightSide;","map":{"version":3,"sources":["/Users/ruchikaashokbharati/Documents/SocialMediaProject-main/client/src/components/message/RightSide.js"],"names":["React","useEffect","useState","useRef","UserCard","useDispatch","useSelector","useParams","MsgDisplay","Icons","GLOBALTYPES","imageShow","videoShow","imageUpload","addMessage","getMessages","MESSAGE_TYPES","LoadIcon","RightSide","state","auth","message","theme","socket","dispatch","user","setUser","text","setText","page","setPage","data","setData","id","media","setMedia","loadMedia","setLoadMedia","refDisplay","pageEnd","console","log","newData","filter","item","sender","_id","newUser","users","find","handleChangeMedia","e","files","target","err","newMedia","forEach","file","size","push","type","ALERT","payload","error","handleDeleteMedia","index","newArr","splice","handleSubmit","preventDefault","trim","length","msg","recipient","createdAt","Date","toISOString","current","scrollIntoView","behaviour","block","getMessagesData","GET_MESSAGES","messages","observer","IntersectionObserver","entries","isIntersecting","p","threshold","observe","resultData","height","marginTop","opacity","map","display","match","URL","createObjectURL","value","background","color"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useRef } from 'react';\r\nimport UserCard from \"../UserCard\";\r\nimport { useDispatch, useSelector } from 'react-redux';\r\nimport { useParams } from 'react-router-dom';\r\nimport MsgDisplay from './MsgDisplay';\r\nimport Icons from \"../Icons\";\r\nimport { GLOBALTYPES } from '../../redux/actions/globalTypes';\r\nimport { imageShow, videoShow } from '../../utils/mediaShow';\r\nimport { imageUpload } from '../../utils/imageUpload';\r\nimport { addMessage, getMessages, MESSAGE_TYPES } from '../../redux/actions/messageAction';\r\nimport LoadIcon from '../../images/loading.gif';\r\n\r\nconst RightSide = () => {\r\n    const { auth, message, theme, socket } = useSelector(state => state);\r\n    const dispatch = useDispatch();\r\n    const [user, setUser] = useState([]);\r\n    const [text, setText] = useState('');\r\n    const [page, setPage] = useState(0);\r\n    const [data, setData] = useState([]);\r\n    const { id } = useParams();\r\n    const [media, setMedia] = useState([]);\r\n    const [loadMedia, setLoadMedia] = useState(false);\r\n\r\n    const refDisplay = useRef();\r\n    const pageEnd = useRef();\r\n\r\n    useEffect(() => {\r\n      console.log(\"socket\",socket);\r\n      console.log(\"auth\",auth.user);\r\n      const newData = message.data.filter(\r\n        (item) => item.sender === auth.user._id || item.sender === id\r\n      );\r\n      console.log(\"newdata\",newData);\r\n      setData(newData);\r\n    }, [message.data, auth.user._id, id]);\r\n\r\n    useEffect(() => {\r\n      const newUser = message.users.find((user) => user._id === id);\r\n      console.log(\"newUser\",newUser);\r\n      if (newUser) {\r\n        setUser(newUser);\r\n      }\r\n    }, [message.users, id]);\r\n\r\n    const handleChangeMedia = (e) => {\r\n      const files = [...e.target.files];\r\n    let err = \"\";\r\n    let newMedia = [];\r\n\r\n    files.forEach((file) => {\r\n      if (!file) {\r\n        return (err = \"File does not exist.\");\r\n      }\r\n      if (file.size > 1024 * 1024 * 5) {\r\n        return (err = \"Image size must be less than 5 mb.\");\r\n      }\r\n      return newMedia.push(file);\r\n    });\r\n    if (err) {\r\n      dispatch({ type: GLOBALTYPES.ALERT, payload: { error: err } });\r\n    }\r\n    setMedia([...media, ...newMedia]);\r\n    };\r\n\r\n    const handleDeleteMedia = (index) => {\r\n      console.log(\"im in handle delete media\");\r\n      const newArr = [...media];\r\n      newArr.splice(index, 1);\r\n      setMedia(newArr);\r\n    };\r\n\r\n    const handleSubmit = async e => {\r\n      e.preventDefault();\r\n      console.log(\"text\",text);\r\n      if(!text.trim() && media.length === 0) return;\r\n      setText('');\r\n      setMedia([]);\r\n      setLoadMedia(true);\r\n      let newArr = [];\r\n      if(media.length > 0) newArr = await imageUpload(media);\r\n      const msg = {\r\n        sender: auth.user._id,\r\n        recipient: id,\r\n        text,\r\n        media: newArr,\r\n        createdAt: new Date().toISOString()\r\n      }\r\n      setLoadMedia(false);\r\n      await dispatch(addMessage({msg, auth, socket}));\r\n      if (refDisplay.current) {\r\n        refDisplay.current.scrollIntoView({\r\n          behaviour: \"smooth\",\r\n          block: \"end\",\r\n        });\r\n      }\r\n    };\r\n\r\n    useEffect(() => {\r\n      if (id) {\r\n        const getMessagesData = async () => {\r\n\r\n          dispatch({type: MESSAGE_TYPES.GET_MESSAGES, payload: { messages: [] } });\r\n          \r\n          setPage(1);\r\n          dispatch(getMessages({ auth, id }));\r\n          if(refDisplay.current){\r\n            refDisplay.current.scrollIntoView({behaviour: 'smooth', block: 'end'});\r\n          }\r\n        };\r\n\r\n        getMessagesData();\r\n      }\r\n    }, [id, dispatch, auth]);\r\n\r\n    // load more\r\n\r\n    useEffect(() => {\r\n      const observer = new IntersectionObserver(\r\n        (entries) => {\r\n          if (entries[0].isIntersecting) {\r\n            setPage((p) => p + 1);\r\n          }\r\n        },\r\n        {\r\n          threshold: 0.1,\r\n        }\r\n      );\r\n      observer.observe(pageEnd.current);\r\n    }, [setPage]);\r\n\r\n    useEffect(() => {\r\n      if (message.resultData >= (page - 1) * 9 && page > 1) {\r\n        dispatch(getMessages({ auth, id, page }));\r\n      }\r\n    }, [message.resultData, page, id, auth, dispatch]);\r\n\r\n    useEffect(() => {\r\n      if (refDisplay.current) {\r\n        refDisplay.current.scrollIntoView({\r\n          behaviour: \"smooth\",\r\n          block: \"end\",\r\n        });\r\n      }\r\n    }, [text])\r\n\r\n    return (\r\n      <>\r\n        <div className=\"message_header\">\r\n          {user.length !== 0 && (\r\n            <UserCard user={user}>\r\n              <i className=\"fas fa-trash text-danger\" />\r\n            </UserCard>\r\n          )}\r\n        </div>\r\n\r\n        <div\r\n          className=\"chat_container\"\r\n          style={{ height: media.length > 0 ? \"calc(100% - 180px)\" : \"\" }}\r\n        >\r\n          <div className=\"chat_display\" ref={refDisplay}>\r\n            <button style={{marginTop: '-25px', opacity: 0}} ref={pageEnd}>Load..</button>\r\n\r\n            {data.map((msg, index) => (\r\n              <div key={index}>\r\n                {msg.sender !== auth.user._id && (\r\n                  <div className=\"chat_row other_message\">\r\n                    <MsgDisplay user={user} msg={msg} theme={theme} />\r\n                  </div>\r\n                )}\r\n                {msg.sender === auth.user._id && (\r\n                  <div className=\"chat_row you_message\">\r\n                    <MsgDisplay user={auth.user} msg={msg} theme={theme} />\r\n                  </div>\r\n                )}\r\n              </div>\r\n            ))}\r\n            {loadMedia && (\r\n              <div className=\"chat_row you_message\">\r\n                <img src={LoadIcon} alt=\"Loading...\" />\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        <div\r\n          className=\"show_media\"\r\n          style={{ display: media.length > 0 ? \"\" : \"none\" }}\r\n        >\r\n          {media.map((item, index) => (\r\n            <div key={index} id=\"file_media\">\r\n              {item.type.match(/video/i)\r\n                ? videoShow(URL.createObjectURL(item), theme)\r\n                : imageShow(URL.createObjectURL(item), theme)}\r\n              <span onClick={() => handleDeleteMedia(index)}>&times;</span>\r\n            </div>\r\n          ))}\r\n        </div>\r\n\r\n        <form className=\"chat_input\" onSubmit={handleSubmit}>\r\n          <input\r\n            placeholder=\"Type a message.\"\r\n            type=\"text\"\r\n            value={text}\r\n            onChange={(e) => setText(e.target.value)}\r\n            style={{ filter: theme ? \"invert(1)\" : \"invert(0)\" , background: theme ? '#040404' : '', color: theme ? 'white' : ''}}\r\n          />\r\n          <Icons setContent={setText} content={text} theme={theme} />\r\n          <div className=\"file_upload\">\r\n            <i className=\"fas fa-image color-c1\" />\r\n            <input\r\n              type=\"file\"\r\n              name=\"file\"\r\n              id=\"file\"\r\n              multiple\r\n              accept=\"image/*,video/*\"\r\n              onChange={handleChangeMedia}\r\n            />\r\n          </div>\r\n          <button\r\n            type=\"submit\"\r\n            disabled={text || media.length > 0 ? false : true}\r\n            className=\"material-icons\"\r\n          >\r\n            near_me\r\n          </button>\r\n        </form>\r\n      </>\r\n    );\r\n}\r\n\r\nexport default RightSide\r\n"]},"metadata":{},"sourceType":"module"}