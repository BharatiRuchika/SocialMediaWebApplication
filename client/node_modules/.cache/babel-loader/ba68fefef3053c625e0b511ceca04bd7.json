{"ast":null,"code":"import _toConsumableArray from\"/Users/ruchikaashokbharati/Documents/SocialMediaProject-main/client/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _objectSpread from\"/Users/ruchikaashokbharati/Documents/SocialMediaProject-main/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/Users/ruchikaashokbharati/Documents/SocialMediaProject-main/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _regeneratorRuntime from\"/Users/ruchikaashokbharati/Documents/SocialMediaProject-main/client/node_modules/@babel/runtime/regenerator/index.js\";import{GLOBALTYPES}from\"./globalTypes\";import{postDataAPI,getDataAPI,patchDataAPI,deleteDataAPI}from\"../../utils/fetchData\";import{imageUpload}from\"../../utils/imageUpload\";import{createNotify,removeNotify}from\"./notifyAction\";export var POST_TYPES={CREATE_POST:\"CREATE_POST\",LOADING_POST:\"LOADING_POST\",GET_POSTS:\"GET_POSTS\",UPDATE_POST:\"UPDATE_POST\",GET_POST:\"GET_POST\",DELETE_POST:\"DELETE_POST\",REPORT_POST:\"REPORT_POST\",SAVE_POST:\"SAVE_POST\"};export var createPost=function createPost(_ref){var content=_ref.content,images=_ref.images,auth=_ref.auth,socket=_ref.socket;return/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch){var media,res,msg;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:media=[];_context.prev=1;dispatch({type:GLOBALTYPES.ALERT,payload:{loading:true}});if(!(images.length>0)){_context.next=7;break;}_context.next=6;return imageUpload(images);case 6:media=_context.sent;case 7:_context.next=9;return postDataAPI('posts',{content:content,images:media},auth.token);case 9:res=_context.sent;dispatch({type:POST_TYPES.CREATE_POST,payload:_objectSpread(_objectSpread({},res.data.newPost),{},{user:auth.user})});dispatch({type:GLOBALTYPES.ALERT,payload:{loading:false}});// todo notification\nmsg={id:res.data.newPost._id,text:\"Added a new post.\",recipients:res.data.newPost.user.followers,url:\"/post/\".concat(res.data.newPost._id),content:content,image:media[0].url};dispatch(createNotify({msg:msg,auth:auth,socket:socket}));_context.next=19;break;case 16:_context.prev=16;_context.t0=_context[\"catch\"](1);dispatch({type:GLOBALTYPES.ALERT,payload:{error:_context.t0.response.data.msg}});case 19:case\"end\":return _context.stop();}}},_callee,null,[[1,16]]);}));return function(_x){return _ref2.apply(this,arguments);};}();};export var getPosts=function getPosts(token){return/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(dispatch){var res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;dispatch({type:POST_TYPES.LOADING_POST,payload:true});_context2.next=4;return getDataAPI('posts',token);case 4:res=_context2.sent;console.log(\"resdata\",res);dispatch({type:POST_TYPES.GET_POSTS,payload:_objectSpread(_objectSpread({},res.data),{},{page:2})});dispatch({type:POST_TYPES.LOADING_POST,payload:false});_context2.next=13;break;case 10:_context2.prev=10;_context2.t0=_context2[\"catch\"](0);dispatch({type:GLOBALTYPES.ALERT,payload:{error:_context2.t0.response.data.msg}});case 13:case\"end\":return _context2.stop();}}},_callee2,null,[[0,10]]);}));return function(_x2){return _ref3.apply(this,arguments);};}();};export var updatePost=function updatePost(_ref4){var content=_ref4.content,images=_ref4.images,auth=_ref4.auth,status=_ref4.status;return/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(dispatch){var media,imgNewUrl,imgOldUrl,res;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:media=[];imgNewUrl=images.filter(function(img){return!img.url;});imgOldUrl=images.filter(function(img){return img.url;});if(!(status.content===content&&imgNewUrl.length===0&&imgOldUrl.length===status.images.length)){_context3.next=5;break;}return _context3.abrupt(\"return\");case 5:_context3.prev=5;dispatch({type:GLOBALTYPES.ALERT,payload:{loading:true}});if(!(imgNewUrl.length>0)){_context3.next=11;break;}_context3.next=10;return imageUpload(imgNewUrl);case 10:media=_context3.sent;case 11:_context3.next=13;return patchDataAPI(\"post/\".concat(status._id),{content:content,images:[].concat(_toConsumableArray(imgOldUrl),_toConsumableArray(media))},auth.token);case 13:res=_context3.sent;dispatch({type:POST_TYPES.UPDATE_POST,payload:res.data.newPost});dispatch({type:GLOBALTYPES.ALERT,payload:{success:res.data.msg}});_context3.next=21;break;case 18:_context3.prev=18;_context3.t0=_context3[\"catch\"](5);dispatch({type:GLOBALTYPES.ALERT,payload:{error:_context3.t0.response.data.msg}});case 21:case\"end\":return _context3.stop();}}},_callee3,null,[[5,18]]);}));return function(_x3){return _ref5.apply(this,arguments);};}();};export var likePost=function likePost(_ref6){var post=_ref6.post,auth=_ref6.auth,socket=_ref6.socket;return/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(dispatch){var newPost,msg;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:newPost=_objectSpread(_objectSpread({},post),{},{likes:[].concat(_toConsumableArray(post.likes),[auth.user])});dispatch({type:POST_TYPES.UPDATE_POST,payload:newPost});socket.emit(\"likePost\",newPost);_context4.prev=3;_context4.next=6;return patchDataAPI(\"post/\".concat(post._id,\"/like\"),null,auth.token);case 6:// todo notification\nmsg={id:auth.user._id,text:\"Liked your post.\",recipients:[post.user._id],url:\"/post/\".concat(post._id),content:post.content,image:post.images[0].url};dispatch(createNotify({msg:msg,auth:auth,socket:socket}));_context4.next=13;break;case 10:_context4.prev=10;_context4.t0=_context4[\"catch\"](3);dispatch({type:GLOBALTYPES.ALERT,payload:{error:_context4.t0.response.data.msg}});case 13:case\"end\":return _context4.stop();}}},_callee4,null,[[3,10]]);}));return function(_x4){return _ref7.apply(this,arguments);};}();};export var unLikePost=function unLikePost(_ref8){var post=_ref8.post,auth=_ref8.auth,socket=_ref8.socket;return/*#__PURE__*/function(){var _ref9=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(dispatch){var newPost,msg;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:newPost=_objectSpread(_objectSpread({},post),{},{likes:post.likes.filter(function(like){return like._id!==auth.user._id;})});dispatch({type:POST_TYPES.UPDATE_POST,payload:newPost});socket.emit(\"unLikePost\",newPost);_context5.prev=3;_context5.next=6;return patchDataAPI(\"post/\".concat(post._id,\"/unlike\"),null,auth.token);case 6:// todo notification\nmsg={id:auth.user._id,text:\"Liked your post.\",recipients:[post.user._id],url:\"/post/\".concat(post._id)};dispatch(removeNotify({msg:msg,auth:auth,socket:socket}));_context5.next=13;break;case 10:_context5.prev=10;_context5.t0=_context5[\"catch\"](3);dispatch({type:GLOBALTYPES.ALERT,payload:{error:_context5.t0.response.data.msg}});case 13:case\"end\":return _context5.stop();}}},_callee5,null,[[3,10]]);}));return function(_x5){return _ref9.apply(this,arguments);};}();};export var getPost=function getPost(_ref10){var detailPost=_ref10.detailPost,id=_ref10.id,auth=_ref10.auth;return/*#__PURE__*/function(){var _ref11=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(dispatch){var res;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:console.log(\"im in get post action\");if(!detailPost.every(function(post){return post._id!==id;})){_context6.next=13;break;}_context6.prev=2;_context6.next=5;return getDataAPI(\"post/\".concat(id),auth.token);case 5:res=_context6.sent;dispatch({type:POST_TYPES.GET_POST,payload:res.data.post});console.log(\"res\",res);_context6.next=13;break;case 10:_context6.prev=10;_context6.t0=_context6[\"catch\"](2);dispatch({type:GLOBALTYPES.ALERT,payload:{error:_context6.t0.response.data.msg}});case 13:case\"end\":return _context6.stop();}}},_callee6,null,[[2,10]]);}));return function(_x6){return _ref11.apply(this,arguments);};}();};export var deletePost=function deletePost(_ref12){var post=_ref12.post,auth=_ref12.auth,socket=_ref12.socket;return/*#__PURE__*/function(){var _ref13=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(dispatch){var res,msg;return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:dispatch({type:POST_TYPES.DELETE_POST,payload:post});_context7.prev=1;_context7.next=4;return deleteDataAPI(\"post/\".concat(post._id),auth.token);case 4:res=_context7.sent;// todo notification\nmsg={id:post._id,text:\"Added a new post.\",recipients:res.data.newPost.user.followers,url:\"/post/\".concat(post._id)};dispatch(removeNotify({msg:msg,auth:auth,socket:socket}));_context7.next=12;break;case 9:_context7.prev=9;_context7.t0=_context7[\"catch\"](1);dispatch({type:GLOBALTYPES.ALERT,payload:{error:_context7.t0.response.data.msg}});case 12:case\"end\":return _context7.stop();}}},_callee7,null,[[1,9]]);}));return function(_x7){return _ref13.apply(this,arguments);};}();};export var reportPost=function reportPost(_ref14){var post=_ref14.post,auth=_ref14.auth;return/*#__PURE__*/function(){var _ref15=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(dispatch){var reportExist,newPost,res;return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:reportExist=post.reports.find(function(report){return report===auth.user._id;});if(!(reportExist&&reportExist.length>0)){_context8.next=3;break;}return _context8.abrupt(\"return\",dispatch({type:GLOBALTYPES.ALERT,payload:{error:\"You have already reported this post.\"}}));case 3:newPost=_objectSpread({},post);newPost.reports.push(auth.user._id);dispatch({type:POST_TYPES.REPORT_POST,payload:newPost});_context8.prev=6;_context8.next=9;return patchDataAPI(\"post/\".concat(post._id,\"/report\"),null,auth.token);case 9:res=_context8.sent;dispatch({type:GLOBALTYPES.ALERT,payload:{success:res.data.msg}});_context8.next=16;break;case 13:_context8.prev=13;_context8.t0=_context8[\"catch\"](6);dispatch({type:GLOBALTYPES.ALERT,payload:{error:_context8.t0.response.data.msg}});case 16:case\"end\":return _context8.stop();}}},_callee8,null,[[6,13]]);}));return function(_x8){return _ref15.apply(this,arguments);};}();};export var savePost=function savePost(_ref16){var post=_ref16.post,auth=_ref16.auth;return/*#__PURE__*/function(){var _ref17=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee9(dispatch){var newUser;return _regeneratorRuntime.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:newUser=_objectSpread(_objectSpread({},auth.user),{},{saved:[].concat(_toConsumableArray(auth.user.saved),[post._id])});dispatch({type:GLOBALTYPES.AUTH,payload:_objectSpread(_objectSpread({},auth),{},{user:newUser})});_context9.prev=2;_context9.next=5;return patchDataAPI(\"savePost/\".concat(post._id),null,auth.token);case 5:_context9.next=10;break;case 7:_context9.prev=7;_context9.t0=_context9[\"catch\"](2);dispatch({type:GLOBALTYPES.ALERT,payload:{error:_context9.t0.response.data.msg}});case 10:case\"end\":return _context9.stop();}}},_callee9,null,[[2,7]]);}));return function(_x9){return _ref17.apply(this,arguments);};}();};export var unSavePost=function unSavePost(_ref18){var post=_ref18.post,auth=_ref18.auth;return/*#__PURE__*/function(){var _ref19=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee10(dispatch){var newUser;return _regeneratorRuntime.wrap(function _callee10$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:newUser=_objectSpread(_objectSpread({},auth.user),{},{saved:auth.user.saved.filter(function(id){return id!==post._id;})});dispatch({type:GLOBALTYPES.AUTH,payload:_objectSpread(_objectSpread({},auth),{},{user:newUser})});_context10.prev=2;_context10.next=5;return patchDataAPI(\"unSavePost/\".concat(post._id),null,auth.token);case 5:_context10.next=10;break;case 7:_context10.prev=7;_context10.t0=_context10[\"catch\"](2);dispatch({type:GLOBALTYPES.ALERT,payload:{error:_context10.t0.response.data.msg}});case 10:case\"end\":return _context10.stop();}}},_callee10,null,[[2,7]]);}));return function(_x10){return _ref19.apply(this,arguments);};}();};","map":{"version":3,"sources":["/Users/ruchikaashokbharati/Documents/SocialMediaProject-main/client/src/redux/actions/postAction.js"],"names":["GLOBALTYPES","postDataAPI","getDataAPI","patchDataAPI","deleteDataAPI","imageUpload","createNotify","removeNotify","POST_TYPES","CREATE_POST","LOADING_POST","GET_POSTS","UPDATE_POST","GET_POST","DELETE_POST","REPORT_POST","SAVE_POST","createPost","content","images","auth","socket","dispatch","media","type","ALERT","payload","loading","length","token","res","data","newPost","user","msg","id","_id","text","recipients","followers","url","image","error","response","getPosts","console","log","page","updatePost","status","imgNewUrl","filter","img","imgOldUrl","success","likePost","post","likes","emit","unLikePost","like","getPost","detailPost","every","deletePost","reportPost","reportExist","reports","find","report","push","savePost","newUser","saved","AUTH","unSavePost"],"mappings":"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","sourcesContent":["import { GLOBALTYPES } from \"./globalTypes\";\nimport { postDataAPI, getDataAPI, patchDataAPI, deleteDataAPI } from \"../../utils/fetchData\";\nimport { imageUpload } from \"../../utils/imageUpload\";\nimport { createNotify, removeNotify } from \"./notifyAction\";\n\n\nexport const POST_TYPES = {\n  CREATE_POST: \"CREATE_POST\",\n  LOADING_POST: \"LOADING_POST\",\n  GET_POSTS: \"GET_POSTS\",\n  UPDATE_POST: \"UPDATE_POST\",\n  GET_POST: \"GET_POST\",\n  DELETE_POST: \"DELETE_POST\",\n  REPORT_POST: \"REPORT_POST\",\n  SAVE_POST: \"SAVE_POST\",\n};\n\nexport const createPost = ({content, images, auth, socket}) => async dispatch => {\n    let media = [];\n\n    try {\n        dispatch({ type: GLOBALTYPES.ALERT, payload: {loading: true} });\n\n        if(images.length > 0){ media = await imageUpload(images)}\n\n        const res = await postDataAPI('posts', {content, images: media}, auth.token );\n\n        \n        dispatch({ type: POST_TYPES.CREATE_POST , payload: {...res.data.newPost, user: auth.user} });\n        \n        dispatch({ type: GLOBALTYPES.ALERT, payload: { loading: false } });\n        \n\n        // todo notification\n        const msg = {\n          id: res.data.newPost._id,\n          text: \"Added a new post.\",\n          recipients: res.data.newPost.user.followers,\n          url: `/post/${res.data.newPost._id}`,\n          content, \n          image: media[0].url\n        };\n\n        dispatch(createNotify({msg, auth, socket}));\n\n    } catch (err) {\n        dispatch({\n            type: GLOBALTYPES.ALERT,\n            payload: {\n                error: err.response.data.msg\n            }\n        })\n    }\n}\n\n\nexport const getPosts = (token) => async dispatch => {\n    try {\n        dispatch({ type: POST_TYPES.LOADING_POST, payload: true  });\n        const res = await getDataAPI('posts', token);\n        console.log(\"resdata\",res);\n        dispatch({ type: POST_TYPES.GET_POSTS, payload: {...res.data, page: 2} });\n\n        dispatch({ type: POST_TYPES.LOADING_POST, payload: false });\n    } catch (err) {\n        dispatch({\n          type: GLOBALTYPES.ALERT,\n          payload: {\n            error: err.response.data.msg,\n          },\n        });\n    }\n}\n\n\nexport const updatePost = ({ content, images, auth, status }) => async (dispatch) => {\n  let media = [];\n    const imgNewUrl = images.filter(img => !img.url);\n    const imgOldUrl = images.filter(img => img.url);\n    if(status.content === content && imgNewUrl.length === 0 && imgOldUrl.length === status.images.length){\n        return;\n    }\n  try {\n    dispatch({ type: GLOBALTYPES.ALERT, payload: { loading: true } });\n    if (imgNewUrl.length > 0) {\n      media = await imageUpload(imgNewUrl);\n    }\n    const res = await patchDataAPI(\n      `post/${status._id}`,\n      { content, images: [...imgOldUrl, ...media] },\n      auth.token\n    );\n    \n    dispatch({ type: POST_TYPES.UPDATE_POST, payload: res.data.newPost });\n    dispatch({ type: GLOBALTYPES.ALERT, payload: { success: res.data.msg } });\n  } catch (err) {\n    dispatch({\n      type: GLOBALTYPES.ALERT,\n      payload: {\n        error: err.response.data.msg,\n      },\n    });\n  }\n};\n\n\nexport const likePost = ({ post, auth, socket }) => async (dispatch) => {\n  const newPost = {...post, likes: [...post.likes, auth.user]};\n\n  dispatch({type: POST_TYPES.UPDATE_POST, payload: newPost});\n  socket.emit(\"likePost\", newPost);\n  \n  try {\n    await patchDataAPI(`post/${post._id}/like`, null, auth.token);\n\n    // todo notification\n    const msg = {\n      id: auth.user._id,\n      text: \"Liked your post.\",\n      recipients: [post.user._id],\n      url: `/post/${post._id}`,\n      content: post.content,\n      image: post.images[0].url,\n    };\n\n    dispatch(createNotify({ msg, auth, socket }));\n  } catch (err) {\n    dispatch({\n      type: GLOBALTYPES.ALERT,\n      payload: {\n        error: err.response.data.msg,\n      },\n    });\n  }\n};\n\n\nexport const unLikePost = ({ post, auth, socket }) => async (dispatch) => {\n  const newPost = { ...post, likes: post.likes.filter(like => like._id !== auth.user._id) };\n\n  dispatch({ type: POST_TYPES.UPDATE_POST, payload: newPost });\n  socket.emit(\"unLikePost\", newPost);\n\n  \n  try {\n    await patchDataAPI(`post/${post._id}/unlike`, null, auth.token);\n\n    // todo notification\n    const msg = {\n      id: auth.user._id,\n      text: \"Liked your post.\",\n      recipients: [post.user._id],\n      url: `/post/${post._id}`, \n    };\n\n    dispatch(removeNotify({ msg, auth, socket }));\n  } catch (err) {\n    dispatch({\n      type: GLOBALTYPES.ALERT,\n      payload: {\n        error: err.response.data.msg,\n      },\n    });\n  }\n};\n\n\nexport const getPost = ({ detailPost, id, auth }) => async (dispatch) => {\n  console.log(\"im in get post action\");\n  if(detailPost.every(post => post._id !== id )){\n    try {\n      const res = await getDataAPI(`post/${id}`, auth.token);\n      dispatch({ type: POST_TYPES.GET_POST, payload: res.data.post})\n      console.log(\"res\",res);\n\n    } catch (err) {\n      dispatch({\n        type: GLOBALTYPES.ALERT,\n        payload: {\n          error: err.response.data.msg,\n        },\n      });\n    }\n  }\n};\n\n\nexport const deletePost = ({ post, auth, socket }) => async (dispatch) => {\n  dispatch({ type: POST_TYPES.DELETE_POST, payload: post });\n\n  try {\n    const res = await deleteDataAPI(`post/${post._id}`, auth.token);\n\n    // todo notification\n    const msg = {\n      id: post._id,\n      text: \"Added a new post.\",\n      recipients: res.data.newPost.user.followers,\n      url: `/post/${post._id}`,\n    };\n\n    dispatch(removeNotify({ msg, auth, socket }));\n  } catch (err) {\n    dispatch({\n      type: GLOBALTYPES.ALERT,\n      payload: {\n        error: err.response.data.msg,\n      },\n    });\n  }\n};\n\n\nexport const reportPost = ({ post, auth }) => async (dispatch) => {\n\n  const reportExist = post.reports.find(report => report === auth.user._id);\n\n  if (reportExist && reportExist.length > 0) {\n    return dispatch({\n      type: GLOBALTYPES.ALERT,\n      payload: { error: \"You have already reported this post.\" },\n    });\n  }\n    const newPost = { ...post };\n    newPost.reports.push(auth.user._id);\n\n  dispatch({ type: POST_TYPES.REPORT_POST, payload: newPost });\n  \n\ntry {\n  const res = await patchDataAPI(`post/${post._id}/report`, null, auth.token);\n  dispatch({ type: GLOBALTYPES.ALERT, payload: { success: res.data.msg } });\n} catch (err) {\n  dispatch({\n    type: GLOBALTYPES.ALERT,\n    payload: {\n      error: err.response.data.msg,\n    },\n  });\n}\n};\n\nexport const savePost = ({ post, auth }) => async (dispatch) => {\n  const newUser = {...auth.user, saved: [...auth.user.saved, post._id] };\n\n  dispatch({ type: GLOBALTYPES.AUTH, payload: {...auth, user: newUser}});\n\n\n  try {\n    await patchDataAPI(`savePost/${post._id}`, null, auth.token);\n  } catch (err) {\n    dispatch({\n      type: GLOBALTYPES.ALERT,\n      payload: {\n        error: err.response.data.msg,\n      },\n    });\n  }\n};\n\nexport const unSavePost = ({ post, auth }) => async (dispatch) => {\n  const newUser = { ...auth.user, saved: auth.user.saved.filter(id => id !== post._id) };\n\n  dispatch({ type: GLOBALTYPES.AUTH, payload: { ...auth, user: newUser } });\n\n  try {\n    await patchDataAPI(`unSavePost/${post._id}`, null, auth.token);\n  } catch (err) {\n    dispatch({\n      type: GLOBALTYPES.ALERT,\n      payload: {\n        error: err.response.data.msg,\n      },\n    });\n  }\n};\n"]},"metadata":{},"sourceType":"module"}