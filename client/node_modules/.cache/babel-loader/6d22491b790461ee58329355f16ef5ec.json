{"ast":null,"code":"import _objectSpread from\"/Users/ruchikaashokbharati/Documents/SocialMediaProject-main/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useRef}from\"react\";import{useDispatch,useSelector}from\"react-redux\";import{POST_TYPES}from\"./redux/actions/postAction\";import{ADMIN_TYPES}from\"./redux/actions/adminAction\";import{GLOBALTYPES}from\"./redux/actions/globalTypes\";import{NOTIFY_TYPES}from\"./redux/actions/notifyAction\";import{MESSAGE_TYPES}from\"./redux/actions/messageAction\";import audioTone from'./audio/pristine-609.mp3';// spawnNotification(\n//   msg.user.username + \" \" + msg.text,\n//   msg.user.avatar,\n//   msg.url,\n//   \"CAMPUS CONNECT\"\n// );\nimport{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";var spawnNotification=function spawnNotification(body,icon,url,title){var options={body:body,icon:icon};var n=new Notification(title,options);n.onclick=function(e){e.preventDefault();window.open(url,'_blank');};};var SocketClient=function SocketClient(){var _useSelector=useSelector(function(state){return state;}),auth=_useSelector.auth,socket=_useSelector.socket,notify=_useSelector.notify;var dispatch=useDispatch();var audioRef=useRef();//!connection\nuseEffect(function(){if(auth.user.role===\"user\"){socket.emit(\"joinUser\",auth.user._id);}else if(auth.user.role===\"admin\"){socket.emit(\"joinAdmin\",auth.user._id);}},[socket,auth.user.role,auth.user._id]);useEffect(function(){socket.on(\"getActiveUsersToClient\",function(totalActiveUsers){console.log(\"totalActiveUsers\",totalActiveUsers);dispatch({type:ADMIN_TYPES.GET_TOTAL_ACTIVE_USERS,payload:totalActiveUsers});});return function(){return socket.off(\"getActiveUsersToClient\");};},[socket,dispatch]);//!like Post\nuseEffect(function(){socket.on(\"likeToClient\",function(newPost){dispatch({type:POST_TYPES.UPDATE_POST,payload:newPost});});return function(){return socket.off(\"likeToClient\");};},[socket,dispatch]);//!Unlike Post\nuseEffect(function(){socket.on(\"unLikeToClient\",function(newPost){dispatch({type:POST_TYPES.UPDATE_POST,payload:newPost});});return function(){return socket.off(\"unLikeToClient\");};},[socket,dispatch]);//!Comments\nuseEffect(function(){socket.on(\"createCommentToClient\",function(newPost){dispatch({type:POST_TYPES.UPDATE_POST,payload:newPost});});return function(){return socket.off(\"createCommentToClient\");};},[socket,dispatch]);useEffect(function(){socket.on(\"deleteCommentToClient\",function(newPost){dispatch({type:POST_TYPES.UPDATE_POST,payload:newPost});});return function(){return socket.off(\"deleteCommentToClient\");};},[socket,dispatch]);//!Follow\nuseEffect(function(){socket.on(\"followToClient\",function(newUser){dispatch({type:GLOBALTYPES.AUTH,payload:_objectSpread(_objectSpread({},auth),{},{user:newUser})});});return function(){return socket.off(\"followToClient\");};},[socket,dispatch,auth]);useEffect(function(){socket.on(\"unFollowToClient\",function(newUser){dispatch({type:GLOBALTYPES.AUTH,payload:_objectSpread(_objectSpread({},auth),{},{user:newUser})});});return function(){return socket.off(\"unFollowToClient\");};},[socket,dispatch,auth]);//!Notifications\nuseEffect(function(){socket.on(\"createNotifyToClient\",function(msg){dispatch({type:NOTIFY_TYPES.CREATE_NOTIFY,payload:msg});var audio=new Audio(audioTone);audio.play();if(notify.sound){audioRef.current.play();}spawnNotification(msg.user.username+\" \"+msg.text,msg.user.avatar,msg.url,\"CAMPUS CONNECT\");});return function(){return socket.off(\"createNotifyToClient\");};},[socket,dispatch,notify.sound]);useEffect(function(){socket.on(\"removeNotifyToClient\",function(msg){dispatch({type:NOTIFY_TYPES.REMOVE_NOTIFY,payload:msg});});return function(){return socket.off(\"removeNotifyToClient\");};},[socket,dispatch]);//!Messages\nuseEffect(function(){socket.on(\"addMessageToClient\",function(msg){console.log(\"addMessageToClient socket called\");dispatch({type:MESSAGE_TYPES.ADD_MESSAGE,payload:msg});});return function(){return socket.off(\"addMessageToClient\");};},[]);return/*#__PURE__*/_jsx(_Fragment,{});};export default SocketClient;","map":{"version":3,"sources":["/Users/ruchikaashokbharati/Documents/SocialMediaProject-main/client/src/SocketClient.js"],"names":["React","useEffect","useRef","useDispatch","useSelector","POST_TYPES","ADMIN_TYPES","GLOBALTYPES","NOTIFY_TYPES","MESSAGE_TYPES","audioTone","spawnNotification","body","icon","url","title","options","n","Notification","onclick","e","preventDefault","window","open","SocketClient","state","auth","socket","notify","dispatch","audioRef","user","role","emit","_id","on","totalActiveUsers","console","log","type","GET_TOTAL_ACTIVE_USERS","payload","off","newPost","UPDATE_POST","newUser","AUTH","msg","CREATE_NOTIFY","audio","Audio","play","sound","current","username","text","avatar","REMOVE_NOTIFY","ADD_MESSAGE"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef } from \"react\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { POST_TYPES } from \"./redux/actions/postAction\";\r\nimport { ADMIN_TYPES } from \"./redux/actions/adminAction\";\r\nimport { GLOBALTYPES } from \"./redux/actions/globalTypes\";\r\nimport { NOTIFY_TYPES } from \"./redux/actions/notifyAction\";\r\nimport { MESSAGE_TYPES } from \"./redux/actions/messageAction\";\r\n\r\nimport audioTone from './audio/pristine-609.mp3' \r\n\r\n// spawnNotification(\r\n//   msg.user.username + \" \" + msg.text,\r\n//   msg.user.avatar,\r\n//   msg.url,\r\n//   \"CAMPUS CONNECT\"\r\n// );\r\nconst spawnNotification = (body, icon, url, title) => {\r\n  let options = {\r\n    body, icon\r\n  }\r\n  let n = new Notification(title, options);\r\n  n.onclick =  e => {\r\n    e.preventDefault();\r\n    window.open(url, '_blank');\r\n  }\r\n}\r\n\r\nconst SocketClient = () => {\r\n  const { auth, socket, notify } = useSelector((state) => state);\r\n  const dispatch = useDispatch();\r\n  const audioRef = useRef();\r\n\r\n  //!connection\r\n  useEffect(() => {\r\n    if (auth.user.role === \"user\") {\r\n      socket.emit(\"joinUser\", auth.user._id);\r\n    } else if (auth.user.role === \"admin\") {\r\n      socket.emit(\"joinAdmin\", auth.user._id);\r\n    }\r\n  }, [socket, auth.user.role, auth.user._id]);\r\n\r\n  useEffect(() => {\r\n    socket.on(\"getActiveUsersToClient\", (totalActiveUsers) => {\r\n      console.log(\"totalActiveUsers\",totalActiveUsers);\r\n      dispatch({\r\n        type: ADMIN_TYPES.GET_TOTAL_ACTIVE_USERS,\r\n        payload: totalActiveUsers,\r\n      });\r\n    });\r\n   \r\n    return () => socket.off(\"getActiveUsersToClient\");\r\n  }, [socket, dispatch]);\r\n\r\n  //!like Post\r\n  useEffect(() => {\r\n    socket.on(\"likeToClient\", (newPost) => {\r\n      dispatch({ type: POST_TYPES.UPDATE_POST, payload: newPost });\r\n    });\r\n    \r\n    return () => socket.off(\"likeToClient\");\r\n  }, [socket, dispatch]);\r\n\r\n  //!Unlike Post\r\n  useEffect(() => {\r\n    socket.on(\"unLikeToClient\", (newPost) => {\r\n      dispatch({ type: POST_TYPES.UPDATE_POST, payload: newPost });\r\n    });\r\n   \r\n    return () => socket.off(\"unLikeToClient\");\r\n  }, [socket, dispatch]);\r\n\r\n  //!Comments\r\n  useEffect(() => {\r\n    socket.on(\"createCommentToClient\", (newPost) => {\r\n      dispatch({ type: POST_TYPES.UPDATE_POST, payload: newPost });\r\n     \r\n    });\r\n    return () => socket.off(\"createCommentToClient\");\r\n  }, [socket, dispatch]);\r\n\r\n  useEffect(() => {\r\n    socket.on(\"deleteCommentToClient\", (newPost) => {\r\n      dispatch({ type: POST_TYPES.UPDATE_POST, payload: newPost });\r\n    });\r\n    \r\n    return () => socket.off(\"deleteCommentToClient\");\r\n  }, [socket, dispatch]);\r\n\r\n  //!Follow\r\n  useEffect(() => {\r\n    \r\n    socket.on(\"followToClient\", (newUser) => {\r\n      dispatch({ type: GLOBALTYPES.AUTH, payload: { ...auth, user: newUser } });\r\n    });\r\n   \r\n    return () => socket.off(\"followToClient\");\r\n  }, [socket, dispatch, auth]);\r\n\r\n  useEffect(() => {\r\n    socket.on(\"unFollowToClient\", (newUser) => {\r\n      dispatch({\r\n        type: GLOBALTYPES.AUTH,\r\n        payload: { ...auth, user: newUser },\r\n      });\r\n    });\r\n    return () => socket.off(\"unFollowToClient\");\r\n  }, [socket, dispatch, auth]);\r\n\r\n  //!Notifications\r\n  useEffect(() => {\r\n    socket.on(\"createNotifyToClient\", (msg) => {\r\n      dispatch({ type: NOTIFY_TYPES.CREATE_NOTIFY, payload: msg });\r\n      const audio = new Audio(audioTone);\r\n      audio.play();\r\n      if (notify.sound) {\r\n        audioRef.current.play();\r\n      }\r\n      spawnNotification(\r\n        msg.user.username + \" \" + msg.text,\r\n        msg.user.avatar,\r\n        msg.url,\r\n        \"CAMPUS CONNECT\"\r\n      );\r\n    });\r\n    return () => socket.off(\"createNotifyToClient\");\r\n  }, [socket, dispatch, notify.sound]);\r\n\r\n  useEffect(() => {\r\n    socket.on(\"removeNotifyToClient\", (msg) => {\r\n      dispatch({ type: NOTIFY_TYPES.REMOVE_NOTIFY, payload: msg });\r\n    });\r\n    return () => socket.off(\"removeNotifyToClient\");\r\n  }, [socket, dispatch]);\r\n\r\n  //!Messages\r\n  useEffect(() => {\r\n    socket.on(\"addMessageToClient\", (msg) => {\r\n      console.log(\"addMessageToClient socket called\")\r\n      dispatch({ type: MESSAGE_TYPES.ADD_MESSAGE, payload: msg });\r\n\r\n    });\r\n    return () => socket.off(\"addMessageToClient\");\r\n  }, []);\r\n\r\n  return (\r\n    <>\r\n    \r\n      {/* <audio controls ref={audioRef} style={{display:\"none\"}}>\r\n        <source src={audioTone} type=\"audio/mp3\" />\r\n      </audio> */}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default SocketClient;\r\n"]},"metadata":{},"sourceType":"module"}